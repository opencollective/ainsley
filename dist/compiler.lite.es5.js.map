{"version":3,"file":"compiler.lite.es5.js","sources":["../src/globalThis.js","../src/utils.js","../src/compiler.js"],"sourcesContent":["(function(Object) {\n  typeof globalThis !== \"object\" &&\n    (this\n      ? get()\n      : (Object.defineProperty(Object.prototype, \"_T_\", {\n          configurable: true,\n          get\n        }),\n        _T_));\n  function get() {\n    this.globalThis = this;\n    delete Object.prototype._T_;\n  }\n})(Object);\n","export const fastClone = val => {\n  if (typeof val !== \"object\") return val;\n  const arr = [];\n  const len = val.length;\n  for (let i = 0; i < len; i++) arr.push(fastClone(val[i]));\n  return arr;\n};\n\nexport const map = (arr, fn) => {\n  const out = [];\n  const len = arr.length;\n  for (let i = 0; i < len; i++) out.push(fn(arr[i]));\n  return out;\n};\n\nexport const flat = arr => [].concat.apply([], arr);\n\nexport const combinations = mods => {\n  let list = [[]];\n  while (mods.length)\n    list = flat(mods.shift().map(opt => list.map(prev => prev.concat([opt]))));\n  return list;\n};\n\nexport const assign = objects => {\n  //#if !_LITE\n  if (!Array.isArray(objects)) throw new Error(\"assign needs an array\");\n  //#endif\n\n  const out = {};\n  const len = objects.length;\n  for (let i = 1; i < len; i++) {\n    var obj = objects[i];\n    if (obj) for (let nextKey in obj) out[nextKey] = obj[nextKey];\n  }\n  return out;\n};\n","import \"./globalThis\";\n\nimport { fastClone, map, flat, combinations } from \"./utils\";\n\nexport const propFragMap = {\n  flex: \"fx\",\n  background: \"bg\",\n  min: \"n\",\n  max: \"x\",\n  style: \"st\",\n  overflow: \"ov\",\n  cursor: \"cu\"\n};\n\nexport const iteratorRegex = /\\{[a-z]+\\}/gi;\n\n// private helpers\nconst _abbrev = w => propFragMap[w] || w[0];\nconst _expandDeclaration = subpair => `${subpair[0]}:${subpair[1]}`;\nconst _addEmptyMod = mod => [[\"\", \"\"]].concat(mod);\nconst _abbrevWord = w => w[0].toUpperCase();\n\n// expand ainsley.defs\nexport const expandDefs = (ainsley, ruleSet) => {\n  const pair = ruleSet[1].reduce(\n    (iters, pair) => [\n      iters[0].concat(pair[0].match(iteratorRegex) || []),\n      iters[1].concat(pair[1].match(iteratorRegex) || [])\n    ],\n    [[], []]\n  );\n\n  return map(\n    combinations(\n      map(pair[0].concat(pair[1]), iter =>\n        map(Object.keys(ainsley[iter]), abbr => [\n          iter,\n          abbr,\n          ainsley[iter][abbr]\n        ])\n      )\n    ),\n    perm => {\n      const clone = fastClone(ruleSet);\n      for (let i = 0; clone[0].includes(\"&\"); i++) {\n        clone[0] = clone[0].replace(\"&\", perm[i][1]);\n      }\n      for (let i = 0; i < clone[1].length; i++) {\n        const decl = clone[1][i];\n        while (perm.length > 0 && decl[0].includes(perm[0][0])) {\n          const first = perm.shift();\n          decl[0] = decl[0].replace(first[0], first[2]);\n        }\n      }\n      for (let i = 0; i < clone[1].length; i++) {\n        const decl = clone[1][i];\n        while (perm.length > 0 && decl[1].includes(perm[0][0])) {\n          const first = perm.shift();\n          decl[1] = decl[1].replace(first[0], first[2]);\n        }\n      }\n      return clone;\n    }\n  );\n};\n\n// expand ainsley.props\nexport const expandProps = pair => {\n  const propAbbrev = map(pair[0].split(\"-\"), _abbrev).join(\"\");\n  return map(pair[1], value => [\n    `${propAbbrev}${map(value.split(\" \"), _abbrevWord).join(\"\")}`,\n    [[pair[0], value]]\n  ]);\n};\n\n// compile ainsley to a simple stylesheet ast\nexport const ainsleyToAst = ainsley => {\n  const ast = [].concat(\n    flat(map(ainsley.defs || [], def => expandDefs(ainsley, def))),\n    flat(map(ainsley.props || [], expandProps)),\n    ainsley.raw || []\n  );\n  return flat(\n    map(combinations(map(ainsley.mods || [], _addEmptyMod)), comb =>\n      comb.reduce((ast, pair) => {\n        if (!pair[1]) {\n          return ast;\n        } else if (pair[1][0] === \"@\") {\n          return [\n            [\n              pair[1],\n              map(ast, subpair => [`${pair[0]}${subpair[0]}`, subpair[1]])\n            ]\n          ];\n        } else {\n          return map(ast, subpair => [\n            `${pair[0]}${subpair[0]}${pair[1]}`,\n            subpair[1]\n          ]);\n        }\n      }, ast)\n    )\n  );\n};\n\nexport const ruleToCSS = rule =>\n  rule[0][0] === \"@\"\n    ? `${rule[0]}{${astToCss(rule[1])}}`\n    : `.${rule[0]}{${map(rule[1], _expandDeclaration).join(\";\")}}`;\n\n// generate css from simple stylesheet ast\nexport const astToCss = ast => map(ast, ruleToCSS).join(\"\");\n\n// generate css from ainsley\nexport const ainsleyToCss = ainsley => astToCss(ainsleyToAst(ainsley));\n\n// insert ainsley into a dom\nexport const ainsleyInsert = (ainsley, stylesheet) => {\n  const ast = ainsleyToAst(ainsley);\n  for (let i = ast.length - 1; i >= 0; i--) {\n    stylesheet.insertRule(ruleToCSS(ast[i]), 0);\n  }\n};\n\nif (globalThis.ACCB) globalThis.ACCB(ainsleyToCss);\n"],"names":["Object","get","globalThis","this","prototype","_T_","defineProperty","configurable","map","arr","fn","out","len","length","i","push","flat","concat","apply","combinations","mods","list","shift","opt","prev","propFragMap","flex","background","min","max","style","overflow","cursor","iteratorRegex","_abbrev","w","_expandDeclaration","subpair","_addEmptyMod","mod","_abbrevWord","toUpperCase","expandDefs","ainsley","ruleSet","pair","reduce","iters","match","iter","keys","abbr","perm","clone","fastClone","val","_typeof","includes","replace","decl","first","expandProps","propAbbrev","split","join","value","ruleToCSS","rule","astToCss","ast","ainsleyToCss","defs","def","props","raw","comb","ainsleyToAst","ACCB"],"mappings":"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"}